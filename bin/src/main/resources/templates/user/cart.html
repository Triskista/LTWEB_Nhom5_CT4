<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Giỏ Hàng</title>
<style>
body {
	font-family: Arial, sans-serif;
	margin: 20px;
	background-color: #f4f4f4;
}

.cart-container {
	background-color: white;
	padding: 20px;
	border-radius: 8px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
	max-width: 800px;
	margin: auto;
}

h2 {
	text-align: center;
}

.cart-items {
	margin-bottom: 20px;
}

.cart-item {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 10px;
	border-bottom: 1px solid #ddd;
}

.cart-item img {
	width: 50px;
	height: 50px;
	object-fit: cover;
	margin-right: 10px;
}

.cart-item .item-details {
	flex-grow: 1;
}

.cart-item .item-details span {
	display: block;
}

.item-actions {
	display: flex;
	align-items: center;
}

.item-actions button {
	padding: 5px 10px;
	background-color: #ff6f61;
	color: white;
	border: none;
	cursor: pointer;
}

.total {
	font-weight: bold;
	font-size: 1.2em;
	text-align: right;
}

.checkout {
	display: block;
	width: 100%;
	padding: 10px;
	background-color: #4caf50;
	color: white;
	border: none;
	font-size: 1.2em;
	cursor: pointer;
	text-align: center;
	margin-top: 20px;
}
</style>
<style>
    .quantity-decrease, .quantity-increase {
        padding: 5px 10px;
        background-color: #ff6f61;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 1.2em;
        margin: 0 5px;
    }
    .quantity-decrease:hover, .quantity-increase:hover {
        background-color: #e64a44;
    }
</style>

</head>
<body>

	<!-- Navbar with Home link -->
	<nav>
		<ul>
			<li><a th:href="@{/user/index}"><span class="fa fa-home"></span>
					Trang chủ</a></li>
		</ul>
	</nav>

	<div class="cart-container">
    <!-- Thêm thông báo thành công hoặc lỗi tại đây -->
    <div>
        <!-- Hiển thị thông báo lỗi nếu có -->
        <div th:if="${error}" style="color: red; text-align: center; font-weight: bold; margin-bottom: 20px;">
            <p th:text="${error}"></p>
        </div>
        <!-- Hiển thị thông báo thành công nếu có -->
        <div th:if="${message}" style="color: green; text-align: center; font-weight: bold; margin-bottom: 20px;">
            <p th:text="${message}"></p>
        </div>
    </div>
    
    <h2>Giỏ Hàng</h2>
    <div class="cart-items">
        <!-- Lặp qua các sản phẩm trong giỏ hàng -->
        <div th:each="product, iterStat : ${cartItems}">
            <div class="cart-item">
                <img th:src="${product.image}" alt="Sản phẩm" />
                <div class="item-details">
                    <span th:text="${product.productName}"></span> 
                    <span>Giá: <span th:text="${product.price}"></span> VNĐ</span>
                </div>
                
                <!-- Hiển thị số lượng của sản phẩm -->
                <div class="item-quantity">
                    <form th:action="@{/user/update-cart}" method="post">
                        <input type="hidden" name="productId" th:value="${product.productId}" />
                        
                        <span>Số lượng: </span>
                        <button type="submit" name="quantity" th:value="${quantities[iterStat.index] - 1}" class="quantity-decrease">-</button>
                        <span th:text="${quantities[iterStat.index]}"></span>
                        <button type="submit" name="quantity" th:value="${quantities[iterStat.index] + 1}" class="quantity-increase">+</button>
                    </form>
                </div>

                <!-- Tính tổng tiền cho sản phẩm -->
                <div class="item-total">
                    <span th:text="${product.price * quantities[iterStat.index]}"></span> VNĐ
                </div>
            </div>
        </div>
    </div>

    <div class="total">
    Tổng cộng: <span id="totalAmount" th:text="${totalAmount}"></span> VNĐ
</div>

<form id="orderForm" th:action="@{/user/place-order}" method="post">
    <button type="submit" class="checkout">Đặt hàng</button>
</form>

<script>
    // Lắng nghe sự kiện khi form được submit
    document.getElementById("orderForm").addEventListener("submit", function (event) {
        // Lấy giá trị của `totalAmount`
        const totalAmount = parseFloat(document.getElementById("totalAmount").innerText.trim());

        // Kiểm tra nếu `totalAmount` bằng 0
        if (totalAmount === 0) {
            event.preventDefault(); // Ngăn không cho form gửi dữ liệu
            // Chuyển hướng đến trang user/index#CategorySection
            alert("Không thể đặt hàng vì tổng tiền là 0 VNĐ.");
            window.location.href = "/user/index#CategorySection";
        }
    });
</script>

 <!--    <table id="example1"
			class="table table-bordered table-striped dataTable" role="grid"
			aria-describedby="example1_info">
			<thead>
				<tr role="row">
					<th style="width: 80px;">Order ID</th>
					<th style="width: 150px;">Date</th>
					<th style="width: 130px;">Total Price</th>
					<th style="width: 100px;">User Name</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="order : ${list}">
					<td th:text="${order.orderId}"></td>
					<td th:text="${order.date}"></td>
					<td th:text="${order.totalPrice}"></td>
					<td th:text="${order.user.username}"></td>
			</tbody>
		</table> -->
</div>





	<script>
	let cart = {
		    1: { price: 0, quantity: 1 },
		    2: { price: 0, quantity: 1 }
		};

		function updateCart() {
		    let grandTotal = 0;
		    for (let id in cart) {
		        const item = cart[id];
		        const total = item.price * item.quantity;
		        document.getElementById(`quantity-${id}`).innerText = item.quantity;
		        document.getElementById(`total-${id}`).innerText = `${total.toLocaleString()} VNĐ`;
		        grandTotal += total;
		    }
		    document.getElementById("grand-total").innerText = `${grandTotal.toLocaleString()} VNĐ`;
		}

		function increaseQuantity(id) {
		    cart[id].quantity++;
		    updateCart();
		}

		function decreaseQuantity(id) {
		    if (cart[id].quantity > 1) {
		        cart[id].quantity--;
		        updateCart();
		    }
		}

		updateCart();

	</script>
</body>
</html>
